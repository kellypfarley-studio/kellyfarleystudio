import{BaseDirectory as O}from"./path-E9zjYLSN.js";import{i as t,R as u,C as d}from"./core-BDPGcIsz.js";var l;(function(e){e[e.Start=0]="Start",e[e.Current=1]="Current",e[e.End=2]="End"})(l||(l={}));function f(e){return{isFile:e.isFile,isDirectory:e.isDirectory,isSymlink:e.isSymlink,size:e.size,mtime:e.mtime!==null?new Date(e.mtime):null,atime:e.atime!==null?new Date(e.atime):null,birthtime:e.birthtime!==null?new Date(e.birthtime):null,readonly:e.readonly,fileAttributes:e.fileAttributes,dev:e.dev,ino:e.ino,mode:e.mode,nlink:e.nlink,uid:e.uid,gid:e.gid,rdev:e.rdev,blksize:e.blksize,blocks:e.blocks}}function U(e){const n=new Uint8ClampedArray(e),i=n.byteLength;let r=0;for(let o=0;o<i;o++){const s=n[o];r*=256,r+=s}return r}class w extends u{async read(n){if(n.byteLength===0)return 0;const i=await t("plugin:fs|read",{rid:this.rid,len:n.byteLength}),r=U(i.slice(-8)),o=i instanceof ArrayBuffer?new Uint8Array(i):i;return n.set(o.slice(0,o.length-8)),r===0?null:r}async seek(n,i){return await t("plugin:fs|seek",{rid:this.rid,offset:n,whence:i})}async stat(){const n=await t("plugin:fs|fstat",{rid:this.rid});return f(n)}async truncate(n){await t("plugin:fs|ftruncate",{rid:this.rid,len:n})}async write(n){return await t("plugin:fs|write",{rid:this.rid,data:n})}}async function b(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=await t("plugin:fs|create",{path:e instanceof URL?e.toString():e,options:n});return new w(i)}async function L(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=await t("plugin:fs|open",{path:e instanceof URL?e.toString():e,options:n});return new w(i)}async function m(e,n,i){if(e instanceof URL&&e.protocol!=="file:"||n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");await t("plugin:fs|copy_file",{fromPath:e instanceof URL?e.toString():e,toPath:n instanceof URL?n.toString():n,options:i})}async function p(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await t("plugin:fs|mkdir",{path:e instanceof URL?e.toString():e,options:n})}async function S(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");return await t("plugin:fs|read_dir",{path:e instanceof URL?e.toString():e,options:n})}async function T(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=await t("plugin:fs|read_file",{path:e instanceof URL?e.toString():e,options:n});return i instanceof ArrayBuffer?new Uint8Array(i):Uint8Array.from(i)}async function x(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=await t("plugin:fs|read_text_file",{path:e instanceof URL?e.toString():e,options:n}),r=i instanceof ArrayBuffer?i:Uint8Array.from(i);return new TextDecoder().decode(r)}async function E(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=e instanceof URL?e.toString():e;return await Promise.resolve({path:i,rid:null,async next(){this.rid===null&&(this.rid=await t("plugin:fs|read_text_file_lines",{path:i,options:n}));const r=await t("plugin:fs|read_text_file_lines_next",{rid:this.rid}),o=r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r),s=o[o.byteLength-1]===1;return s?(this.rid=null,{value:null,done:s}):{value:new TextDecoder().decode(o.slice(0,o.byteLength-1)),done:s}},[Symbol.asyncIterator](){return this}})}async function A(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await t("plugin:fs|remove",{path:e instanceof URL?e.toString():e,options:n})}async function _(e,n,i){if(e instanceof URL&&e.protocol!=="file:"||n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");await t("plugin:fs|rename",{oldPath:e instanceof URL?e.toString():e,newPath:n instanceof URL?n.toString():n,options:i})}async function v(e,n){const i=await t("plugin:fs|stat",{path:e instanceof URL?e.toString():e,options:n});return f(i)}async function M(e,n){const i=await t("plugin:fs|lstat",{path:e instanceof URL?e.toString():e,options:n});return f(i)}async function k(e,n,i){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");await t("plugin:fs|truncate",{path:e instanceof URL?e.toString():e,len:n,options:i})}async function F(e,n,i){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");if(n instanceof ReadableStream){const r=await L(e,{read:!1,create:!0,write:!0,...i}),o=n.getReader();try{for(;;){const{done:s,value:c}=await o.read();if(s)break;await r.write(c)}}finally{o.releaseLock(),await r.close()}}else await t("plugin:fs|write_file",n,{headers:{path:encodeURIComponent(e instanceof URL?e.toString():e),options:JSON.stringify(i)}})}async function D(e,n,i){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const r=new TextEncoder;await t("plugin:fs|write_text_file",r.encode(n),{headers:{path:encodeURIComponent(e instanceof URL?e.toString():e),options:JSON.stringify(i)}})}async function z(e,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");return await t("plugin:fs|exists",{path:e instanceof URL?e.toString():e,options:n})}class R extends u{}async function y(e,n,i){const r=Array.isArray(e)?e:[e];for(const a of r)if(a instanceof URL&&a.protocol!=="file:")throw new TypeError("Must be a file URL.");const o=new d;o.onmessage=n;const s=await t("plugin:fs|watch",{paths:r.map(a=>a instanceof URL?a.toString():a),options:i,onEvent:o}),c=new R(s);return()=>{c.close()}}async function C(e,n,i){return await y(e,n,{delayMs:2e3,...i})}async function B(e,n,i){return await y(e,n,{...i,delayMs:void 0})}async function I(e){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");return await t("plugin:fs|size",{path:e instanceof URL?e.toString():e})}export{O as BaseDirectory,w as FileHandle,l as SeekMode,m as copyFile,b as create,z as exists,M as lstat,p as mkdir,L as open,S as readDir,T as readFile,x as readTextFile,E as readTextFileLines,A as remove,_ as rename,I as size,v as stat,k as truncate,C as watch,B as watchImmediate,F as writeFile,D as writeTextFile};
